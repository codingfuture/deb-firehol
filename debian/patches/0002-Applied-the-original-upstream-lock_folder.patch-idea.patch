From: Andrey Galkin <andrey@futoin.org>
Date: Thu, 21 Jan 2016 06:15:05 +0200
Subject: Applied the original upstream-lock_folder.patch idea and updated for
 v3

Description: lock folder
 Put firehol lock files into a specific lock folder.
Origin: debian
Author: Jerome Benoit <calculus@rezozer.net>
---
 contrib/dnsbl-ipset.sh | 8 ++++----
 sbin/firehol.in        | 4 ++--
 sbin/fireqos.in        | 4 ++--
 sbin/link-balancer.in  | 2 +-
 4 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/contrib/dnsbl-ipset.sh b/contrib/dnsbl-ipset.sh
index 3468803..386d2ef 100755
--- a/contrib/dnsbl-ipset.sh
+++ b/contrib/dnsbl-ipset.sh
@@ -120,8 +120,11 @@
 
 PROGRAM_FILE="${0}"
 
+# where is the throttle lock file?
+THROTTLE_LOCK_FILE="/run/lock/dnsbl-ipset.lock"
+
 # single line flock, from man flock
-[ "${DNSBL_IPSET_LOCKER}" != "${0}" ] && exec env DNSBL_IPSET_LOCKER="$0" flock -en "/var/run/dnsbl-ipset.lock" "${0}" "${@}" || :
+[ "${DNSBL_IPSET_LOCKER}" != "${0}" ] && exec env DNSBL_IPSET_LOCKER="$0" flock -en "${THROTTLE_LOCK_FILE}" "${0}" "${@}" || :
 
 LC_ALL=C
 umask 077
@@ -364,9 +367,6 @@ DELAY_BETWEEN_CHECKS="0.2"
 # we will stop processing until this drops below this point
 THROTTLE_THRESHOLD="500"
 
-# where is the throttle lock file?
-THROTTLE_LOCK_FILE="/var/run/dnsbl-ipset.lock"
-
 # enable this for more logging
 DEBUG=0
 
diff --git a/sbin/firehol.in b/sbin/firehol.in
index de53347..a7b7f36 100755
--- a/sbin/firehol.in
+++ b/sbin/firehol.in
@@ -271,8 +271,8 @@ FIREHOL_SPOOL_DIR="/var/spool/firehol"
 # Where temporary files should go?
 # /var/run is usualy a ram drive, so we prefer to use
 # this for temporary files.
-# Default: /var/run/firehol
-FIREHOL_RUN_DIR="/var/run/firehol"
+# Default: /run/firehol
+FIREHOL_RUN_DIR="/run/firehol"
 
 # show a spinner during processing that shows
 # number of iptables statements generated
diff --git a/sbin/fireqos.in b/sbin/fireqos.in
index e06f446..d24263a 100755
--- a/sbin/fireqos.in
+++ b/sbin/fireqos.in
@@ -64,9 +64,9 @@ shopt -s extglob
 
 FIREQOS_SYSLOG_FACILITY="daemon"
 FIREQOS_CONFIG="${FIREQOS_CONFIG_DIR}/fireqos.conf"
-FIREQOS_LOCK_FILE=/var/run/fireqos.lock
+FIREQOS_LOCK_FILE=/run/lock/fireqos.lock
 FIREQOS_LOCK_FILE_TIMEOUT=600
-FIREQOS_DIR=/var/run/fireqos
+FIREQOS_DIR=/run/fireqos
 FIREQOS_SAVE="${FIREQOS_DIR}/.tmp.save.$$.$RANDOM"
 
 # Gets set to 1 if this system cannot handle sub-second resolution
diff --git a/sbin/link-balancer.in b/sbin/link-balancer.in
index 533143c..aef67fd 100755
--- a/sbin/link-balancer.in
+++ b/sbin/link-balancer.in
@@ -63,7 +63,7 @@ if [ "$LB_DEBUGGING" ]; then set -v; set -x; fi
 # link-balancer temporary directory.
 # every instance of link-balancer creates a random directory
 # within this one.
-LB_RUN_DIR="/var/run/link-balancer"
+LB_RUN_DIR="/run/link-balancer"
 
 # If this is set to 1, no checks will be made if the gateways are available.
 # All gateways will be assumed active, if their interfaces are found
